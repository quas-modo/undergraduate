<!-- build time:Sun Jul 16 2023 23:26:21 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Carpe diem" href="https://quas-modo.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Carpe diem" href="https://quas-modo.github.io/atom.xml"><link rel="alternate" type="application/json" title="Carpe diem" href="https://quas-modo.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="cpp"><link rel="canonical" href="https://quas-modo.github.io/2022/11/21/cpp/Homework4-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"><title>Homework4-内存管理 - cpp - NJUSE | quas-modo = Carpe diem = pluck the day</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Homework4-内存管理</h1><div class="meta"><span class="item" title="创建时间：2022-11-21 01:01:58"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-11-21T01:01:58+08:00">2022-11-21</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>22k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>20 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">quas-modo</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/wenjun-lin-asset (5).jpg"></li><li class="item" data-background-image="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/krenz-cushart-10.jpg"></li><li class="item" data-background-image="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/krenz-cushart-shanghai2.jpg"></li><li class="item" data-background-image="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/wenjun-lin-20210203114915.jpg"></li><li class="item" data-background-image="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/krenz-cushart-3-step9.jpg"></li><li class="item" data-background-image="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/wenjun-lin-asset.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/NJUSE/" itemprop="item" rel="index" title="分类于 NJUSE"><span itemprop="name">NJUSE</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/NJUSE/cpp/" itemprop="item" rel="index" title="分类于 cpp"><span itemprop="name">cpp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://quas-modo.github.io/2022/11/21/cpp/Homework4-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="quas-modo"><meta itemprop="description" content="pluck the day, notes/thoughts/nonsense"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Carpe diem"></span><div class="body md" itemprop="articleBody"><p>深拷贝、shared_ptr、memory context<br>map、pair 的应用<br>收获很大的一次作业 qvq<br><span id="more"></span></p><h1 id="homework4-内存管理相关"><a class="anchor" href="#homework4-内存管理相关">#</a> Homework4 - 内存管理相关</h1><h2 id="编写深拷贝容器"><a class="anchor" href="#编写深拷贝容器">#</a> 编写深拷贝容器</h2><p>基于我们给的代码框架，编写一个容器 MyContainer，用该容器维护一个堆内存上的数组</p><p>该内存容器是一个典型的 RAII 容器，通过这个练习学习如何使用 RAII 来安全管理资源</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyContainer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">MyContainer</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_size</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        _data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        _count <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token operator">~</span><span class="token function">MyContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>_data <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            _data <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span><span class="token comment">// 防止二次释放</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        _count <span class="token operator">--</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">MyContainer</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyContainer <span class="token operator">&amp;</span>Other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        _data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span>Other<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Other<span class="token punctuation">.</span>_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            _data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Other<span class="token punctuation">.</span>_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        _size <span class="token operator">=</span> Other<span class="token punctuation">.</span>_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        _count <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    MyContainer <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyContainer <span class="token operator">&amp;</span>Other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>Other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _data<span class="token punctuation">;</span>            </pre></td></tr><tr><td data-num="31"></td><td><pre>            _size <span class="token operator">=</span> Other<span class="token punctuation">.</span>_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            _data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>_size<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token function">copy</span><span class="token punctuation">(</span>Other<span class="token punctuation">.</span>_data<span class="token punctuation">,</span> Other<span class="token punctuation">.</span>_data <span class="token operator">+</span> _size<span class="token punctuation">,</span> _data<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    </pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token comment">// 去掉了参数当中的 const，写了另外一个版本，没有考虑自己 move 给自己的情况，不然会丢失数据……</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">//log：看错题目了，这个函数实现的是拷贝赋值不是移动构造，那没事了</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    MyContainer <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>MyContainer <span class="token operator">&amp;</span>Other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        _size <span class="token operator">=</span> Other<span class="token punctuation">.</span>_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        _data <span class="token operator">=</span> Other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        Other<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        Other<span class="token punctuation">.</span>_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">return</span> _size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">int</span><span class="token operator">*</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">return</span> _data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">return</span> _count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> _count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token comment">// C++11 引入的 initializer_list</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">int</span> <span class="token operator">*</span>_data<span class="token punctuation">&#123;</span><span class="token keyword">nullptr</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token keyword">int</span> _size<span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">int</span> MyContainer<span class="token double-colon punctuation">::</span>_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    MyContainer <span class="token function">m</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>    MyContainer <span class="token function">m2</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>    MyContainer m3 <span class="token operator">=</span> m2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m3<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token comment">// 1 2 3</span></pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>    MyContainer <span class="token function">m1</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre>    MyContainer m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">// 1 2 0</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    MyContainer <span class="token function">m1</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre></pre></td></tr><tr><td data-num="96"></td><td><pre>    MyContainer m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span><span class="token comment">//copy</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>    m1 <span class="token operator">=</span> m2<span class="token punctuation">;</span><span class="token comment">// 赋值</span></pre></td></tr><tr><td data-num="101"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre>    m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span><span class="token comment">// 赋值</span></pre></td></tr><tr><td data-num="105"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token keyword">int</span> <span class="token operator">*</span> prev_ptr <span class="token operator">=</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>    m1 <span class="token operator">=</span> m1<span class="token punctuation">;</span><span class="token comment">// 赋值</span></pre></td></tr><tr><td data-num="110"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> prev_ptr<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token comment">// 1 2 0 2 0 2 0 2 1</span></pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    MyContainer <span class="token function">m1</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>        MyContainer m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre></pre></td></tr><tr><td data-num="125"></td><td><pre>        m1 <span class="token operator">=</span> m2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre></pre></td></tr><tr><td data-num="129"></td><td><pre>        m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>m2<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> m1<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre></pre></td></tr><tr><td data-num="133"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="134"></td><td><pre></pre></td></tr><tr><td data-num="135"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="137"></td><td><pre><span class="token comment">// 1 2 0 2 0 2 0 1</span></pre></td></tr><tr><td data-num="138"></td><td><pre></pre></td></tr><tr><td data-num="139"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>    <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>    <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>    <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="析构函数"><a class="anchor" href="#析构函数">#</a> 析构函数</h3><p>无参数、无返回值、不能重载</p><p>离开作用域后自动销毁</p><p>释放空间时记得将指针设为 nullptr，防止出现多次释放和悬挂指针的情况</p><h3 id="拷贝构造函数"><a class="anchor" href="#拷贝构造函数">#</a> 拷贝构造函数</h3><p>一个对象，多个副本，副本之间是独立的关系。</p><p>创建对象时，用一同类的对象对其初始化的时候进行调用。</p><p>复制拷贝构造、传参拷贝构造、返回值拷贝构造</p><h3 id="移动构造函数"><a class="anchor" href="#移动构造函数">#</a> 移动构造函数</h3><p>移动构造函数移动堆中的资源，即不像复制构造函数复制现有对象的数据并将其分配给新对象移动构造函数只是使<strong>声明对象的指针指向临时对象的数据并清空临时对象的指针</strong>。因此，移动构造函数可以防止在内存中不必要地复制数据。</p><p>移动构造函数的工作看起来有点像默认的成员复制构造函数，但在这种情况下，它会清空临时对象的指针，防止多个对象指向同一内存位置。</p><h3 id="扩展学习"><a class="anchor" href="#扩展学习">#</a> 扩展学习</h3><h4 id="explicit关键字"><a class="anchor" href="#explicit关键字">#</a> explicit 关键字</h4><ol><li>指定构造函数或转换函数 (C++11 起) 为显式，即它不能用于<span class="exturl" data-url="aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy96aC5jcHByZWZlcmVuY2UuY29tL3cvY3BwL2xhbmd1YWdlL2ltcGxpY2l0X2NvbnZlcnNpb24=">隐式转换</span>和<span class="exturl" data-url="aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy96aC5jcHByZWZlcmVuY2UuY29tL3cvY3BwL2xhbmd1YWdlL2NvcHlfaW5pdGlhbGl6YXRpb24=">复制初始化</span>.</li><li>explicit 指定符可以与常量表达式一同使用。函数若且唯若该常量表达式求值为 true 才为显式. (C++20 起)</li></ol><p>构造函数为什么会使用 explicit 关键字进行标注</p><ul><li><p>如果不使用 explicit，对于 <code>MyContainer m = 10</code> ，编译器会进行隐式类型转换，此时程序的行为可能不符合我们预期</p></li><li><p>有的时候利用 explicit 的特性可以帮助我们简化代码，但可能会对可读性造成影响</p></li></ul><h4 id="成员变量定义时为什么加上"><a class="anchor" href="#成员变量定义时为什么加上">#</a> 成员变量定义时为什么加上</h4><p>这是一个好习惯，可以防止一些因未初始化问题导致的难以分析的 bug</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token operator">*</span>_data<span class="token punctuation">&#123;</span><span class="token keyword">nullptr</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> _size<span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="可以尝试在构造函数-拷贝构造-拷贝赋值中插入打印语句查看下列代码的输出"><a class="anchor" href="#可以尝试在构造函数-拷贝构造-拷贝赋值中插入打印语句查看下列代码的输出">#</a> 可以尝试在构造函数、拷贝构造、拷贝赋值中插入打印语句，查看下列代码的输出</h4><h4 id="oo优化"><a class="anchor" href="#oo优化">#</a> OO 优化</h4><pre><code class="language-c++">MyContainer get()&#123;
  MyContainer m &#123;1&#125;;
  return m;
&#125;
int main()&#123;
  MyContainer m = get();
  return 0;
&#125;
</code></pre><ul><li><p>可以先猜测一下共输出多少语句，再运行程序</p><ul><li><p>拷贝了 1 次？2 次？3 次？</p></li><li><p>我在 x86-64 gcc 7.5 上用 - O0 优化的输出结果中，并没有任何拷贝的发生，只有一次构造和一次析构</p><p>cxy 的测试，输出结果如下：</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>create my container<span class="token operator">!</span></pre></td></tr><tr><td data-num="2"></td><td><pre>destroy my container<span class="token operator">!</span></pre></td></tr></table></figure></li></ul></li><li><p>如果实际输出的结果比你预想的要少，可以查看以下链接进一步了解</p><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI5NTMxMjcvd2hhdC1hcmUtY29weS1lbGlzaW9uLWFuZC1yZXR1cm4tdmFsdWUtb3B0aW1pemF0aW9u">https://stackoverflow.com/questions/12953127/what-are-copy-elision-and-return-value-optimization</span></p><p>copy elision 拷贝的省略</p><p>Copy elision is an optimization implemented by most compilers to prevent extra (potentially expensive) copies in certain situations. It makes returning by value or pass-by-value feasible 可行的 in practice (restrictions apply 限制应用).</p></li></ul></li></ul><h3 id="报错"><a class="anchor" href="#报错">#</a> 报错</h3><p>free(): double free detected in tcache 2<br>free（）：在 tcache 2 中检测到双空闲，在执行程序的过程中对同一块内存单元进行了两次 free () 操作</p><h3 id="操作符重载"><a class="anchor" href="#操作符重载">#</a> 操作符重载</h3><p>对于系统的所有操作符，一般情况下，只支持基本数据类型和标准库中提供的 class，对于用户自己定义的 class，如果想支持基本操作，比如比较大小，判断是否相等，等等，则需要用户自己来定义关于这个操作符的具体实现。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vWlktRHJlYW0vcC8xMDA2ODk5My5odG1s">https://www.cnblogs.com/ZY-Dream/p/10068993.html</span></p><h2 id="引用计数的共享内存容器-shared-container"><a class="anchor" href="#引用计数的共享内存容器-shared-container">#</a> 引用计数的共享内存容器 Shared Container</h2><p>目标</p><p>基于我们给的代码框架，编写一个容器 SharedContainer，用该容器维护一个堆内存上的 Content 对象。</p><p>这个堆内存上的对象可被一个或多个 SharedContainer 所共享，当没有 SharedContainer 持有这个对象的话，则销毁这个对象。</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">explicit</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"create "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token operator">~</span><span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"destroy "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> id<span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">char</span> data<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SharedContainer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token comment">//TODO</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">explicit</span> <span class="token function">SharedContainer</span><span class="token punctuation">(</span><span class="token keyword">int</span> mem_id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    _data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Content</span><span class="token punctuation">(</span>mem_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    _ref_count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token operator">*</span>_ref_count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token comment">//TODO</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token operator">~</span><span class="token function">SharedContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token operator">*</span>_ref_count <span class="token operator">=</span> <span class="token operator">*</span>_ref_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>_ref_count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span>_data <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">delete</span> _data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        _data <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token comment">//TODO</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token function">SharedContainer</span><span class="token punctuation">(</span><span class="token keyword">const</span> SharedContainer <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    _data <span class="token operator">=</span> other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    _ref_count <span class="token operator">=</span> other<span class="token punctuation">.</span>_ref_count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token operator">*</span>_ref_count <span class="token operator">=</span> <span class="token operator">*</span>_ref_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token comment">//TODO</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  SharedContainer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> SharedContainer <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token operator">*</span>_ref_count <span class="token operator">=</span> <span class="token operator">*</span>_ref_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>_ref_count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">delete</span> _data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    _data <span class="token operator">=</span> other<span class="token punctuation">.</span>_data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    _ref_count <span class="token operator">=</span> other<span class="token punctuation">.</span>_ref_count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token operator">*</span>_ref_count <span class="token operator">=</span> <span class="token operator">*</span>_ref_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token comment">//TODO</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  <span class="token keyword">int</span> <span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token keyword">return</span> <span class="token operator">*</span>_ref_count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token function">SharedContainer</span><span class="token punctuation">(</span><span class="token keyword">const</span> SharedContainer <span class="token operator">&amp;&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  SharedContainer <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> SharedContainer <span class="token operator">&amp;&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  Content <span class="token operator">*</span>_data<span class="token punctuation">&#123;</span><span class="token keyword">nullptr</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  <span class="token keyword">int</span> <span class="token operator">*</span>_ref_count<span class="token punctuation">&#123;</span><span class="token keyword">nullptr</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  <span class="token comment">//TODO: design your own reference counting mechanism</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>  SharedContainer <span class="token function">m1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>  SharedContainer m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  SharedContainer <span class="token function">m3</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m3<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>  SharedContainer <span class="token function">m1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>  SharedContainer m2 <span class="token operator">=</span> m1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>  m1 <span class="token operator">=</span> m1<span class="token punctuation">;</span><span class="token comment">// 需要考虑拷贝构造的时候，自己给自己赋值的情况</span></pre></td></tr><tr><td data-num="83"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    SharedContainer m3 <span class="token operator">=</span> m1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>  SharedContainer <span class="token function">m1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>  SharedContainer <span class="token function">m2</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>  m1 <span class="token operator">=</span> m2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    SharedContainer <span class="token function">m3</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    m1 <span class="token operator">=</span> m3<span class="token punctuation">;</span><span class="token comment">// 此时已经没有指向 Content1 的指针，应该手动销毁</span></pre></td></tr><tr><td data-num="100"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m3<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m1<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> m2<span class="token punctuation">.</span><span class="token function">get_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="108"></td><td><pre></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>  <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>  <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>  <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="扩展学习待查看"><a class="anchor" href="#扩展学习待查看">#</a> 扩展学习【待查看】</h3><ol><li><p>思考如何扩展本练习中的共享内存容器，以支持对任意类型内存的共享</p><ul><li>请参考 shared_ptr 的基本原理，可能需要一些模板编程的知识</li></ul></li><li><p>有了 shared_ptr，我们是不是可以只需要创建资源，剩下的都交给 shared_ptr 管理</p><ul><li><p>shared_ptr 可能产生循环引用而导致的内存泄漏</p></li><li><p>shared_ptr 的额外性能开销</p><ul><li>标准库的 shared_ptr 不是线程安全的</li></ul></li></ul></li><li><p>shared_ptr 既然能清理不被使用的内存，那么垃圾收集又是什么？</p><ul><li>前者回收资源是 eager 的；后者回收资源是 lazy 的</li><li>前者有循环引用问题；后者没有</li><li>...</li></ul></li></ol><h4 id="智能指针的简介"><a class="anchor" href="#智能指针的简介">#</a> 智能指针的简介</h4><p>垃圾回收机制已经大行其道，得到了诸多编程语言的支持，例如 Java、Python、C#、PHP 等。而 C++ 虽然从来没有公开得支持过垃圾回收机制，但 C<ins>98/03 标准中，支持使用 auto_ptr 智能指针来实现堆内存的自动回收；C</ins>11 新标准在废弃 auto_ptr 的同时，增添了 unique_ptr、shared_ptr 以及 weak_ptr 这 3 个智能指针来实现堆内存的自动回收。</p><p>相较于普通指针，智能指针可以在适当时机<strong>自动释放分配的内存</strong>。</p><p>C++ 智能指针底层是采用<strong>引用计数</strong>的方式实现的。</p><p>均可直接参考 cppreference。</p><h4 id="shared_ptr"><a class="anchor" href="#shared_ptr">#</a> shared_ptr</h4><p><span class="exturl" data-url="aHR0cDovL2MuYmlhbmNoZW5nLm5ldC92aWV3Lzc4OTguaHRtbA==">http://c.biancheng.net/view/7898.html</span></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> p1<span class="token punctuation">;</span>             <span class="token comment">// 不传入任何实参</span></pre></td></tr><tr><td data-num="2"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 传入空指针 nullptr, 指向空指针，计数为 0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">p3</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 明确指向</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 调用拷贝构造函数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">p4</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 或者 std::shared_ptr&lt;int> p4 = p3;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 调用移动构造函数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">p5</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>p4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 或者 std::shared_ptr&lt;int> p5 = std::move (p4);</span></pre></td></tr></table></figure><p>空的 shared_ptr 指针，其初始引用计数为 0，而不是 1。</p><p>同一普通指针不能同时为多个 shared_ptr 对象赋值，否则会导致程序发生异常。</p><p>在初始化 shared_ptr 智能指针时，还可以自定义所指堆内存的释放规则。对于申请的动态数组来说，shared_ptr 指针默认的释放规则是不支持释放数组的，只能自定义对应的释放规则，才能正确地释放申请的堆内存。</p><h4 id="unique_ptr"><a class="anchor" href="#unique_ptr">#</a> unique_ptr</h4><p><span class="exturl" data-url="aHR0cHM6Ly94aHkzMDU0LmdpdGh1Yi5pby9jcHAtdW5pcXVlLXB0ci8=">https://xhy3054.github.io/cpp-unique-ptr/</span></p><ol><li><code>unique_ptr</code> 内部存储一个内置指针，当 <code>unique_ptr</code> 析构时，它的析构函数将会负责析构它持有的对象。</li><li><code>unique_ptr</code> 提供了 <code>operator*()</code> 和 <code>operator-&gt;()</code> 成员函数，像内置指针一样，我们可以使用 * <strong>解引用</strong> unique_ptr，使用 -&gt; 来<strong>访问</strong> unique_ptr 所持有对象的成员。</li><li><code>unique_ptr</code> 并不提供 <strong>copy</strong> 操作，这是为了防止多个 <code>unique_ptr</code> 指向同一对象。</li><li>但 <code>unique_ptr</code> 提供了 <strong>move</strong> 操作，因此我们可以用 <code>std::move()</code> 来转移 unique_ptr。</li></ol><h4 id="weak_ptr"><a class="anchor" href="#weak_ptr">#</a> weak_ptr</h4><p>weak_ptr 是为了配合 shared_ptr 而引入的一种智能指针，它指向一个由 shared_ptr 管理的对象而不影响所指对象的生命周期，也就是将<strong>一个 weak_ptr 绑定到一个 shared_ptr 不会改变 shared_ptr 的引用计数</strong>。不论是否有 weak_ptr 指向，一旦最后一个指向对象的 shared_ptr 被销毁，对象就会被释放。从这个角度看，weak_ptr 更像是 shared_ptr 的一个助手而不是智能指针。</p><p>我们不能使用 weak_ptr 直接访问对象。那么我们如何判断 weak_ptr 指向对象是否存在呢？C++ 中提供了 lock 函数来实现该功能。如果对象存在，lock () 函数返回一个指向共享对象的 shared_ptr，否则返回一个空 shared_ptr。</p><h3 id="pointer-指针还是地址自增"><a class="anchor" href="#pointer-指针还是地址自增">#</a> *pointer 指针还是地址自增？</h3><p><span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODIwODAyMS9ob3ctdG8taW5jcmVtZW50LWEtcG9pbnRlci1hZGRyZXNzLWFuZC1wb2ludGVycy12YWx1ZQ==">https://stackoverflow.com/questions/8208021/how-to-increment-a-pointer-address-and-pointers-value</span></p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// The value pointed at by ptr is incremented</span></pre></td></tr></table></figure><p>注意<strong> operator precedence</strong>—— the ++ operator takes precedence over the * operator, and the () operators take precedence over everything else.</p><h2 id="内存管理-memory-contextmc"><a class="anchor" href="#内存管理-memory-contextmc">#</a> 内存管理 memory context (MC)</h2><blockquote><p>主要考察析构函数</p></blockquote><p>由于 libc 原生的内存管理 API 的种种问题（例如，内存泄露和 double-free），某些数据库管理系统基于这些 API 实现了新的动态内存管理机制。具体地，这些实现中引入了一个称为 “memory context” 的概念（后文简称为 “MC”），动态内存管理不再直接使用 <code>malloc</code> / <code>free</code> 等函数，而是调用某个 MC 对象提供的 API 进行。这些 MC 对象被组织为树状结构，如图 1 所示。这样，使用者不再需要为之前分配的每个内存块调用 <code>free</code> 等函数，而是等到相应的 MC 对象被销毁时统一地归还其下的动态内存。同时，由于树状结构的存在，在销毁较为高层的 MC 对象时，处于低层次的 MC 对象也同样会被销毁。这种机制极大降低了管理动态内存的心智负担，更好地避免了内存泄露和 double-free 等问题。</p><p>可参考 Homework4 中 “内存管理” 的 pdf</p><p>经过分析，用左子树表示子节点，用右子树表示兄弟节点构造树的结构。</p><p>“如果一个 MC 有多个子 MC，那么按照创建这些子 MC 的顺序进行销毁”-》可以看出应该采用<strong>后序遍历</strong></p><p>“如果一个 MC 下的内存块，按照分配顺序的逆序（即，后进先出）的顺序进行销毁”-》可以看出用<strong> stack</strong> 的数据结构模拟</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cassert></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;functional></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stack></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 除了 TODO 标出的部分，不要修改原有的声明和定义，否则后果自负！</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MemoryContext</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">/**</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   * @param parent 父节点，可能为 nullptr</pre></td></tr><tr><td data-num="17"></td><td><pre>   */</pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">MemoryContext</span><span class="token punctuation">(</span>MemoryContext <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token operator">~</span><span class="token function">MemoryContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token comment">// 禁止拷贝和移动</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token function">MemoryContext</span><span class="token punctuation">(</span><span class="token keyword">const</span> MemoryContext <span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  MemoryContext <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MemoryContext <span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token function">MemoryContext</span><span class="token punctuation">(</span>MemoryContext <span class="token operator">&amp;&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  MemoryContext <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>MemoryContext <span class="token operator">&amp;&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">using</span> chunk_id_t <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token keyword">const</span> chunk_id_t <span class="token operator">&amp;</span>chunk_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span>MemoryContext <span class="token operator">*</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token comment">// TODO: your code</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  MemoryContext <span class="token operator">*</span> parentMC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  MemoryContext <span class="token operator">*</span> leftMC<span class="token punctuation">;</span><span class="token comment">// 子节点</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  MemoryContext <span class="token operator">*</span> rightMC<span class="token punctuation">;</span><span class="token comment">// 兄弟节点</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  stack<span class="token operator">&lt;</span>chunk_id_t<span class="token operator">></span> chunk<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token class-name">MemoryContext</span><span class="token double-colon punctuation">::</span><span class="token function">MemoryContext</span><span class="token punctuation">(</span>MemoryContext <span class="token operator">*</span>parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token comment">// TODO: your code</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  parentMC <span class="token operator">=</span> parent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  leftMC <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  rightMC <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>parentMC <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    MemoryContext <span class="token operator">*</span> tmp <span class="token operator">=</span> parent<span class="token operator">-></span>leftMC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>tmp <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>      parent <span class="token operator">-></span> leftMC <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span>tmp <span class="token operator">-></span> rightMC <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        tmp <span class="token operator">=</span> tmp<span class="token operator">-></span>rightMC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>      tmp <span class="token operator">-></span> rightMC <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token class-name">MemoryContext</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">MemoryContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  <span class="token comment">// TODO: your code</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  MemoryContext <span class="token operator">*</span> pointer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>pointer <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span>pointer<span class="token operator">-></span>parentMC <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    pointer <span class="token operator">=</span> pointer <span class="token operator">-></span> parentMC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>  <span class="token class-name">MemoryContext</span><span class="token double-colon punctuation">::</span><span class="token function">release</span><span class="token punctuation">(</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MemoryContext</span><span class="token double-colon punctuation">::</span><span class="token function">release</span><span class="token punctuation">(</span>MemoryContext <span class="token operator">*</span> ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>ptr <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  MemoryContext <span class="token operator">*</span> child <span class="token operator">=</span> ptr<span class="token operator">-></span>leftMC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>  MemoryContext <span class="token operator">*</span> next <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span>child <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token function">release</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    next <span class="token operator">=</span> child <span class="token operator">-></span> rightMC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token comment">// delete child;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    child <span class="token operator">=</span> next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>  chunk_id_t str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token operator">-></span>chunk<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    str <span class="token operator">=</span> ptr<span class="token operator">-></span>chunk<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    ptr<span class="token operator">-></span>chunk<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Chunk "</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">" freed."</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MemoryContext</span><span class="token double-colon punctuation">::</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token keyword">const</span> chunk_id_t <span class="token operator">&amp;</span>chunk_id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>  chunk<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token keyword">void</span> <span class="token function">test_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span> A <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token keyword">void</span> <span class="token function">test_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span> A <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>  MemoryContext <span class="token operator">*</span>B <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>  MemoryContext <span class="token operator">*</span>C <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre></pre></td></tr><tr><td data-num="108"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="118"></td><td><pre></pre></td></tr><tr><td data-num="119"></td><td><pre><span class="token keyword">void</span> <span class="token function">test_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span> A <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>  MemoryContext <span class="token operator">*</span>B <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>  MemoryContext <span class="token operator">*</span>C <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>  MemoryContext <span class="token operator">*</span>D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>  MemoryContext <span class="token operator">*</span>E <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>  MemoryContext <span class="token operator">*</span>F <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>  MemoryContext <span class="token operator">*</span>G <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>E<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre></pre></td></tr><tr><td data-num="128"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>  D<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>  D<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>  G<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2/1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="137"></td><td><pre></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token keyword">void</span> <span class="token function">test_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span> A <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>  MemoryContext <span class="token operator">*</span>B <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>  MemoryContext <span class="token operator">*</span>C <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>  MemoryContext <span class="token operator">*</span>D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>  MemoryContext <span class="token operator">*</span>E <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>  MemoryContext <span class="token operator">*</span>F <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>  MemoryContext <span class="token operator">*</span>G <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>  D<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>  D<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>  E<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/1/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="155"></td><td><pre>  F<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>  G<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2/3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>  G<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2/5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="158"></td><td><pre>  G<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>  G<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1/2/4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="161"></td><td><pre></pre></td></tr><tr><td data-num="162"></td><td><pre><span class="token keyword">void</span> <span class="token function">test_5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>  std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span> A <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>MemoryContext<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="164"></td><td><pre>  MemoryContext <span class="token operator">*</span>B <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>  MemoryContext <span class="token operator">*</span>C <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="166"></td><td><pre>  MemoryContext <span class="token operator">*</span>D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="167"></td><td><pre>  MemoryContext <span class="token operator">*</span>G <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemoryContext</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre></pre></td></tr><tr><td data-num="169"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>  A<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="173"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"2/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="174"></td><td><pre>  B<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"3/5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="175"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1024/2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="176"></td><td><pre>  C<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"1024/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre>  G<span class="token operator">-></span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token string">"8192/1/4095"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="179"></td><td><pre></pre></td></tr><tr><td data-num="180"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">REGISTER_TEST_CASE</span><span class="token expression"><span class="token punctuation">(</span>name<span class="token punctuation">)</span> </span><span class="token punctuation">\</span></span></pre></td></tr><tr><td data-num="181"></td><td><pre>  <span class="token expression"><span class="token punctuation">&#123;</span> #name<span class="token punctuation">,</span> name <span class="token punctuation">&#125;</span></span></pre></td></tr><tr><td data-num="182"></td><td><pre></pre></td></tr><tr><td data-num="183"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>  std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span></pre></td></tr><tr><td data-num="185"></td><td><pre>      test_functions_by_name <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>      <span class="token function">REGISTER_TEST_CASE</span><span class="token punctuation">(</span>test_1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">REGISTER_TEST_CASE</span><span class="token punctuation">(</span>test_2<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="187"></td><td><pre>      <span class="token function">REGISTER_TEST_CASE</span><span class="token punctuation">(</span>test_3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">REGISTER_TEST_CASE</span><span class="token punctuation">(</span>test_4<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="188"></td><td><pre>      <span class="token function">REGISTER_TEST_CASE</span><span class="token punctuation">(</span>test_5<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="189"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="190"></td><td><pre></pre></td></tr><tr><td data-num="191"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string test_case_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="192"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cin <span class="token operator">>></span> test_case_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="193"></td><td><pre>  <span class="token keyword">auto</span> it <span class="token operator">=</span> test_functions_by_name<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>test_case_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="194"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>it <span class="token operator">!=</span> test_functions_by_name<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="195"></td><td><pre>  <span class="token keyword">auto</span> fn <span class="token operator">=</span> it<span class="token operator">-></span>second<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="196"></td><td><pre>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="197"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="198"></td><td><pre></pre></td></tr><tr><td data-num="199"></td><td><pre><span class="token comment">// 摸了 1h30min 但是不是很懂</span></pre></td></tr></table></figure><h3 id="cpp中this的理解"><a class="anchor" href="#cpp中this的理解">#</a> cpp 中 this 的理解</h3><p>在 C++ 中，每一个对象都能通过 <strong>this</strong> 指针来访问自己的地址。<strong>this</strong> 指针是所有成员函数的隐含参数。因此，在成员函数内部，它可以用来指向调用对象。</p><h3 id="stack"><a class="anchor" href="#stack">#</a> stack</h3><p>pop 不返回参数，只是弹出</p><p>需要用 top 函数进行顶层元素的访问</p><h3 id="报错-2"><a class="anchor" href="#报错-2">#</a> 报错</h3><p>basic_string::_M_construct null not valid 错误的原因</p><p>将 String 初始化为 NULL，这显然是非常降智的</p><h2 id="ui-设计"><a class="anchor" href="#ui-设计">#</a> UI 设计</h2><p>公司 A 开发设计软件。请逐步实现功能。</p><p>具体可参见 UI.pdf</p><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 改代码的 group 功能有些问题，无法正常访问</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;algorithm></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">rectangle</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  string id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> red<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">int</span> green<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> blue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">double</span> grey<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">group</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  vector<span class="token operator">&lt;</span>rectangle <span class="token operator">*</span><span class="token operator">></span> mem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  string gid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">bool</span> <span class="token function">cmp1</span><span class="token punctuation">(</span>rectangle a<span class="token punctuation">,</span> rectangle b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">int</span> aid <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">int</span> bid <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>aid <span class="token operator">&lt;</span> bid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">bool</span> <span class="token function">cmp2</span><span class="token punctuation">(</span>rectangle a<span class="token punctuation">,</span> rectangle b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">double</span> agrey <span class="token operator">=</span> a<span class="token punctuation">.</span>grey<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">double</span> bgrey <span class="token operator">=</span> b<span class="token punctuation">.</span>grey<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>agrey <span class="token operator">&lt;</span> bgrey<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>agrey <span class="token operator">></span> bgrey<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">cmp1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>vector<span class="token operator">&lt;</span>string<span class="token operator">></span> <span class="token function">split</span><span class="token punctuation">(</span>string str<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  string delimiter <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  size_t pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  string token<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  vector<span class="token operator">&lt;</span>string<span class="token operator">></span> ret<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>delimiter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    token <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    str<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token operator">+</span>delimiter<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">return</span> ret<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>  <span class="token keyword">int</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  cin <span class="token operator">>></span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  cin <span class="token operator">>></span> ws<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  vector<span class="token operator">&lt;</span>rectangle<span class="token operator">></span> rec<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  vector<span class="token operator">&lt;</span>group<span class="token operator">></span> grp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  vector<span class="token operator">&lt;</span>string<span class="token operator">></span> op<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  string operation<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> operation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    op <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"Add"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>      rectangle foo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>      foo<span class="token punctuation">.</span>type <span class="token operator">=</span> op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>      foo<span class="token punctuation">.</span>id <span class="token operator">=</span> op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>      foo<span class="token punctuation">.</span>red <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>      foo<span class="token punctuation">.</span>green <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>      foo<span class="token punctuation">.</span>blue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>      foo<span class="token punctuation">.</span>grey <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>      rec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"Group"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>      <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>      group foo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>      foo<span class="token punctuation">.</span>gid <span class="token operator">=</span> op<span class="token punctuation">[</span>op<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">+</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> item <span class="token operator">:</span> rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>          <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">==</span> op<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>            foo<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>      grp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"Set"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"P"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span> rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>          <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">==</span> op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"normal"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>              item<span class="token punctuation">.</span>red <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>              item<span class="token punctuation">.</span>green <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>              item<span class="token punctuation">.</span>blue <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"reverse"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>              item<span class="token punctuation">.</span>red <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>              item<span class="token punctuation">.</span>green <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>              item<span class="token punctuation">.</span>blue <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span><span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>              item<span class="token punctuation">.</span>red <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>              item<span class="token punctuation">.</span>green <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>              item<span class="token punctuation">.</span>blue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>gp<span class="token operator">:</span> grp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>          <span class="token keyword">if</span><span class="token punctuation">(</span>gp<span class="token punctuation">.</span>gid <span class="token operator">==</span> op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span> gp<span class="token punctuation">.</span>mem<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>              <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token operator">-></span>type <span class="token operator">==</span> <span class="token string">"normal"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>                item<span class="token operator">-></span>red <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>                item<span class="token operator">-></span>green <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>                item<span class="token operator">-></span>blue <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>              <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token operator">-></span>type <span class="token operator">==</span> <span class="token string">"reverse"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>                item<span class="token operator">-></span>red <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>                item<span class="token operator">-></span>green <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>                item<span class="token operator">-></span>blue <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span><span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>              <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>                item<span class="token operator">-></span>red <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>                item<span class="token operator">-></span>green <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>                item<span class="token operator">-></span>blue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>              <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="137"></td><td><pre></pre></td></tr><tr><td data-num="138"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="140"></td><td><pre></pre></td></tr><tr><td data-num="141"></td><td><pre>  <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> operation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>operation <span class="token operator">==</span> <span class="token string">"Normal"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>    <span class="token function">sort</span><span class="token punctuation">(</span>rec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rec<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>operation <span class="token operator">==</span> <span class="token string">"Gray"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span>rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>      item<span class="token punctuation">.</span>grey <span class="token operator">=</span> item<span class="token punctuation">.</span>red <span class="token operator">*</span> <span class="token number">0.299</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>green <span class="token operator">*</span> <span class="token number">0.587</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>blue <span class="token operator">*</span> <span class="token number">0.114</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>    <span class="token function">sort</span><span class="token punctuation">(</span>rec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rec<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span>rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>id <span class="token operator">&lt;&lt;</span><span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>red <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>green <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>blue <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>  </pre></td></tr><tr><td data-num="154"></td><td><pre>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span> rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="155"></td><td><pre>      cout <span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>type <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>  </pre></td></tr><tr><td data-num="158"></td><td><pre>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>gp<span class="token operator">:</span> grp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>      cout <span class="token operator">&lt;&lt;</span> gp<span class="token punctuation">.</span>gid <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span>gp<span class="token punctuation">.</span>mem<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>          cout <span class="token operator">&lt;&lt;</span> item<span class="token operator">-></span>type <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gp<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="164"></td><td><pre>          cout <span class="token operator">&lt;&lt;</span> gp<span class="token punctuation">.</span>mem<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>type <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="166"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="167"></td><td><pre></pre></td></tr><tr><td data-num="168"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 抽象了一个 set 函数，缩了 20 行</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;algorithm></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">rectangle</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  string id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> red<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">int</span> green<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> blue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token function">rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">green</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">blue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//struct 的初始化</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">double</span> <span class="token function">grey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> red <span class="token operator">*</span> <span class="token number">0.299</span> <span class="token operator">+</span> green <span class="token operator">*</span> <span class="token number">0.587</span> <span class="token operator">+</span> blue <span class="token operator">*</span> <span class="token number">0.114</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token comment">//set 归 set， 初始化归初始化</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> g<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    red <span class="token operator">=</span> r<span class="token punctuation">;</span> green <span class="token operator">=</span> g<span class="token punctuation">;</span> blue <span class="token operator">=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">"reverse"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      red <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> r<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      green <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> g<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      blue <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">"single"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      green <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      blue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">group</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  vector<span class="token operator">&lt;</span>string<span class="token operator">></span> mem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  string gid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">bool</span> <span class="token function">cmp1</span><span class="token punctuation">(</span>rectangle a<span class="token punctuation">,</span> rectangle b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token keyword">int</span> aid <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token keyword">int</span> bid <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>aid <span class="token operator">&lt;</span> bid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">bool</span> <span class="token function">cmp2</span><span class="token punctuation">(</span>rectangle a<span class="token punctuation">,</span> rectangle b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> b<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> b<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">cmp1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>vector<span class="token operator">&lt;</span>string<span class="token operator">></span> <span class="token function">split</span><span class="token punctuation">(</span>string str<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  string delimiter <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  size_t pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  string token<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  vector<span class="token operator">&lt;</span>string<span class="token operator">></span> ret<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>delimiter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    token <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    str<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token operator">+</span>delimiter<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>  ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token keyword">return</span> ret<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>  <span class="token keyword">int</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>  cin <span class="token operator">>></span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>  cin <span class="token operator">>></span> ws<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>  vector<span class="token operator">&lt;</span>rectangle<span class="token operator">></span> rec<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>  vector<span class="token operator">&lt;</span>group<span class="token operator">></span> grp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>  vector<span class="token operator">&lt;</span>string<span class="token operator">></span> op<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>  string operation<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> operation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    op <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"Add"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>      rectangle foo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>      foo<span class="token punctuation">.</span>type <span class="token operator">=</span> op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>      foo<span class="token punctuation">.</span>id <span class="token operator">=</span> op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>      rec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"Group"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>      <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>      group foo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>      foo<span class="token punctuation">.</span>gid <span class="token operator">=</span> op<span class="token punctuation">[</span>op<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">+</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> item <span class="token operator">:</span> rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>          <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">==</span> op<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            foo<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>      grp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"Set"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"P"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span> rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>          <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">==</span> op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            item<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>gp<span class="token operator">:</span> grp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>          <span class="token keyword">if</span><span class="token punctuation">(</span>gp<span class="token punctuation">.</span>gid <span class="token operator">==</span> op<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>            vector<span class="token operator">&lt;</span>string<span class="token operator">></span> gpmem <span class="token operator">=</span> gp<span class="token punctuation">.</span>mem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gpmem<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span> rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>                <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">==</span> gpmem<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>                  item<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stoi</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>                  <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>              <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>  <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> operation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>operation <span class="token operator">==</span> <span class="token string">"Normal"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token function">sort</span><span class="token punctuation">(</span>rec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rec<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>operation <span class="token operator">==</span> <span class="token string">"Gray"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>    <span class="token function">sort</span><span class="token punctuation">(</span>rec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rec<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>item<span class="token operator">:</span>rec<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>id <span class="token operator">&lt;&lt;</span><span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>red <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>green <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token operator">&lt;&lt;</span> item<span class="token punctuation">.</span>blue <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="141"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 佬的代码</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">RECT</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">int</span> G<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">int</span> B<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 将 set 的函数抽象出来重复调用</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> g<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        R <span class="token operator">=</span> r<span class="token punctuation">;</span> G <span class="token operator">=</span> g<span class="token punctuation">;</span> B <span class="token operator">=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        </pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">"reverse"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            R <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            G <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> G<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            B <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> B<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">"single"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            G <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            B <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>   </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// 不用单独存一个 gray 的量，用函数进行比较</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">double</span> <span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">return</span> R<span class="token operator">*</span><span class="token number">0.299</span> <span class="token operator">+</span> G<span class="token operator">*</span><span class="token number">0.587</span> <span class="token operator">+</span> B<span class="token operator">*</span><span class="token number">0.114</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">bool</span> <span class="token function">cmpgray</span><span class="token punctuation">(</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> a<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> b<span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> a<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">return</span> a<span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">bool</span> <span class="token function">cmpi</span><span class="token punctuation">(</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> a<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">return</span> a<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> groups<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> rects<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">int</span> N<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    cin <span class="token operator">>></span> N<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>N<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        string cmd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        cin <span class="token operator">>></span> cmd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd <span class="token operator">==</span> <span class="token string">"Add"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            RECT tmp<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            cin <span class="token operator">>></span> tmp<span class="token punctuation">.</span>type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token keyword">int</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" P%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            rects<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd <span class="token operator">==</span> <span class="token string">"Set"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token keyword">int</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" P%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                <span class="token keyword">int</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                cin <span class="token operator">>></span> r <span class="token operator">>></span> g <span class="token operator">>></span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                rects<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" G%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre>                vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> gr <span class="token operator">=</span> groups<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                <span class="token keyword">int</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                cin <span class="token operator">>></span> r <span class="token operator">>></span> g <span class="token operator">>></span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">:</span> gr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                    rects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd <span class="token operator">==</span> <span class="token string">"Group"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token keyword">int</span> N1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            cin <span class="token operator">>></span> N1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>            vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token keyword">while</span> <span class="token punctuation">(</span>N1 <span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                <span class="token keyword">int</span> t<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" P%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                tmp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token keyword">int</span> gid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" G%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            groups<span class="token punctuation">[</span>gid<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>    string o<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    cin <span class="token operator">>></span> o<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>    vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">>></span> outputs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>pair<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> r<span class="token operator">:</span> rects<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>        outputs<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token string">"Normal"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token function">sort</span><span class="token punctuation">(</span>outputs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> outputs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmpi<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token function">sort</span><span class="token punctuation">(</span>outputs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> outputs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmpgray<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>pair<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token punctuation">,</span> RECT<span class="token operator">></span> r<span class="token operator">:</span> outputs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"P"</span> <span class="token operator">&lt;&lt;</span> r<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> r<span class="token punctuation">.</span>second<span class="token punctuation">.</span>R <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> r<span class="token punctuation">.</span>second<span class="token punctuation">.</span>G <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> r<span class="token punctuation">.</span>second<span class="token punctuation">.</span>B <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="struct"><a class="anchor" href="#struct">#</a> struct</h3><p>struct 默认成员函数是<strong> public</strong> 的</p><p>struct 可以写函数</p><h3 id="pair"><a class="anchor" href="#pair">#</a> pair</h3><p>pair 的定义 ——pair 可以理解为一个<strong>结构体</strong>，pair 将一对值 (T1 和 T2) 组合成一个值，这一对值可以具有<strong>不同的数据类型</strong>（T1 和 T2），两个值可以分别用 pair 的两个公有函数<strong> first</strong> 和<strong> second</strong> 访问。</p><p>pair 的应用 ——pair 是将 2 个数据组合成一组数据，当需要这样的需求时就可以使用 pair，如 stl 中的 map 就是将 key 和 value 放在一起来保存。另一个应用是，当一个函数需要返回 2 个数据的时候，可以选择 pair。</p><h4 id="pair的定义"><a class="anchor" href="#pair的定义">#</a> pair 的定义</h4><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pair<span class="token operator">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token operator">></span> p1<span class="token punctuation">;</span>            <span class="token comment">// 创建一个空的 pair 对象（使用默认构造），它的两个元素分别是 T1 和 T2 类型，采用值初始化。</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pair<span class="token operator">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token operator">></span> <span class="token function">p1</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 创建一个 pair 对象，它的两个元素分别是 T1 和 T2 类型，其中 first 成员初始化为 v1，second 成员初始化为 v2。</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">make_pair</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 以 v1 和 v2 的值创建一个新的 pair 对象，其元素类型分别是 v1 和 v2 的类型。</span></pre></td></tr><tr><td data-num="4"></td><td><pre>p1 <span class="token operator">&lt;</span> p2<span class="token punctuation">;</span>                    <span class="token comment">// 两个 pair 对象间的小于运算，其定义遵循字典次序：如 p1.first &lt; p2.first 或者！(p2.first &lt; p1.first) &amp;&amp; (p1.second &lt; p2.second) 则返回 true。</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p1 <span class="token operator">==</span> p2；                  <span class="token comment">// 如果两个对象的 first 和 second 依次相等，则这两个对象相等；该运算使用元素的 == 操作符。</span></pre></td></tr><tr><td data-num="6"></td><td><pre>p1<span class="token punctuation">.</span>first<span class="token punctuation">;</span>                   <span class="token comment">// 返回对象 p1 中名为 first 的公有数据成员</span></pre></td></tr><tr><td data-num="7"></td><td><pre>p1<span class="token punctuation">.</span>second<span class="token punctuation">;</span>                 <span class="token comment">// 返回对象 p1 中名为 second 的公有数据成员</span></pre></td></tr></table></figure><h4 id="pair的初始化"><a class="anchor" href="#pair的初始化">#</a> pair 的初始化</h4><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">></span> anon<span class="token punctuation">;</span>        <span class="token comment">// 创建一个空对象 anon，两个元素类型都是 string</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> word_count<span class="token punctuation">;</span>     <span class="token comment">// 创建一个空对象 word_count, 两个元素类型分别是 string 和 int 类型</span></pre></td></tr><tr><td data-num="3"></td><td><pre>pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">></span> line<span class="token punctuation">;</span>  <span class="token comment">// 创建一个空对象 line，两个元素类型分别是 string 和 vector 类型</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">></span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token string">"James"</span><span class="token punctuation">,</span><span class="token string">"Joy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 创建一个 author 对象，两个元素类型分别为 string 类型，并默认初始值为 James 和 Joy。</span></pre></td></tr><tr><td data-num="7"></td><td><pre>pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">name_age</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">name_age2</span><span class="token punctuation">(</span>name_age<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 拷贝构造初始化</span></pre></td></tr></table></figure><h4 id="typedef简化"><a class="anchor" href="#typedef简化">#</a> typedef 简化</h4><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> pair<span class="token operator">&lt;</span>string<span class="token punctuation">,</span>string<span class="token operator">></span> Author<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Author <span class="token function">proust</span><span class="token punctuation">(</span><span class="token string">"March"</span><span class="token punctuation">,</span><span class="token string">"Proust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Author <span class="token function">Joy</span><span class="token punctuation">(</span><span class="token string">"James"</span><span class="token punctuation">,</span><span class="token string">"Joy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="make_pair"><a class="anchor" href="#make_pair">#</a> make_pair</h4><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">></span> p1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>p1 <span class="token operator">=</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> </pre></td></tr><tr><td data-num="4"></td><td><pre>cout <span class="token operator">&lt;&lt;</span> p1<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> p1<span class="token punctuation">.</span>second <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//output: 1 1.2</span></pre></td></tr></table></figure><h3 id="struct-initialization"><a class="anchor" href="#struct-initialization">#</a> struct initialization</h3><p><img data-src="https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/image-20221117152152036.png" alt="image-20221117152152036"></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BhdWxrZzEyL2FydGljbGUvZGV0YWlscy84NTE5ODYyNA==">https://blog.csdn.net/paulkg12/article/details/85198624</span></p><div class="tags"><a href="/tags/cpp/" rel="tag"><i class="ic i-tag"></i> cpp</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-11-21 01:03:24" itemprop="dateModified" datetime="2022-11-21T01:03:24+08:00">2022-11-21</time> </span><span id="2022/11/21/cpp/Homework4-内存管理/" class="item leancloud_visitors" data-flag-title="Homework4-内存管理" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="quas-modo 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.jpg" alt="quas-modo 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="quas-modo 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>quas-modo <i class="ic i-at"><em>@</em></i>Carpe diem</li><li class="link"><strong>本文链接：</strong> <a href="https://quas-modo.github.io/2022/11/21/cpp/Homework4-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" title="Homework4-内存管理">https://quas-modo.github.io/2022/11/21/cpp/Homework4-内存管理/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/11/15/COA/Lecture10-%E6%A3%80%E9%94%99%E4%B8%8E%E7%BA%A0%E9%94%99/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;quasdo.oss-cn-hangzhou.aliyuncs.com&#x2F;img&#x2F;wenjun-lin-asset.jpg" title="Lecture10-检错与纠错"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机组成与结构</span><h3>Lecture10-检错与纠错</h3></a></div><div class="item right"><a href="/2022/11/21/COA/Lecture11-RAID/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;quasdo.oss-cn-hangzhou.aliyuncs.com&#x2F;img&#x2F;wenjun-lin-chinese-shadow-puppetry.jpg" title="Lecture11-RAID"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机组成与结构</span><h3>Lecture11-RAID</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#homework4-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3"><span class="toc-number">1.</span> <span class="toc-text">Homework4 - 内存管理相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%AE%B9%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">编写深拷贝容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">析构函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">拷贝构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.3.</span> <span class="toc-text">移动构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.1.4.</span> <span class="toc-text">扩展学习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#explicit%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">explicit 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E6%97%B6%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8A%A0%E4%B8%8A"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">成员变量定义时为什么加上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E5%B0%9D%E8%AF%95%E5%9C%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0-%E6%8B%B7%E8%B4%9D%E8%B5%8B%E5%80%BC%E4%B8%AD%E6%8F%92%E5%85%A5%E6%89%93%E5%8D%B0%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8B%E4%B8%8B%E5%88%97%E4%BB%A3%E7%A0%81%E7%9A%84%E8%BE%93%E5%87%BA"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">可以尝试在构造函数、拷贝构造、拷贝赋值中插入打印语句，查看下列代码的输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#oo%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.4.4.</span> <span class="toc-text">OO 优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99"><span class="toc-number">1.1.5.</span> <span class="toc-text">报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6%E9%87%8D%E8%BD%BD"><span class="toc-number">1.1.6.</span> <span class="toc-text">操作符重载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E5%AE%B9%E5%99%A8-shared-container"><span class="toc-number">1.2.</span> <span class="toc-text">引用计数的共享内存容器 Shared Container</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0%E5%BE%85%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">扩展学习【待查看】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E7%9A%84%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">智能指针的简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shared_ptr"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">shared_ptr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unique_ptr"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">unique_ptr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#weak_ptr"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">weak_ptr</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pointer-%E6%8C%87%E9%92%88%E8%BF%98%E6%98%AF%E5%9C%B0%E5%9D%80%E8%87%AA%E5%A2%9E"><span class="toc-number">1.2.2.</span> <span class="toc-text">*pointer 指针还是地址自增？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-memory-contextmc"><span class="toc-number">1.3.</span> <span class="toc-text">内存管理 memory context (MC)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cpp%E4%B8%ADthis%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">cpp 中 this 的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack"><span class="toc-number">1.3.2.</span> <span class="toc-text">stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99-2"><span class="toc-number">1.3.3.</span> <span class="toc-text">报错</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ui-%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.4.</span> <span class="toc-text">UI 设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#struct"><span class="toc-number">1.4.1.</span> <span class="toc-text">struct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pair"><span class="toc-number">1.4.2.</span> <span class="toc-text">pair</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pair%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">pair 的定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pair%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">pair 的初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#typedef%E7%AE%80%E5%8C%96"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">typedef 简化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#make_pair"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">make_pair</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#struct-initialization"><span class="toc-number">1.4.3.</span> <span class="toc-text">struct initialization</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/09/15/cpp/Lecture03-%E7%BB%93%E6%9E%84%E5%8C%96%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" rel="bookmark" title="Lecture03-结构化程序设计">Lecture03-结构化程序设计</a></li><li><a href="/2022/09/21/cpp/Lecture04-%E7%AC%AC%E4%B8%80%E6%AC%A1cpp%E7%BC%96%E7%A8%8B/" rel="bookmark" title="Lecture04-第一次cpp编程">Lecture04-第一次cpp编程</a></li><li><a href="/2022/09/22/cpp/105-STL/" rel="bookmark" title="105 STL">105 STL</a></li><li><a href="/2022/09/29/cpp/Lecture06-%E5%87%BD%E6%95%B0/" rel="bookmark" title="Lecture06-函数">Lecture06-函数</a></li><li><a href="/2022/10/04/cpp/Lecture07-%E7%A8%8B%E5%BA%8F%E7%BB%84%E7%BB%87/" rel="bookmark" title="Lecture07-程序组织">Lecture07-程序组织</a></li><li><a href="/2022/10/18/cpp/Lecture08-%E6%95%B0%E7%BB%84%E5%92%8C%E6%8C%87%E9%92%88/" rel="bookmark" title="Lecture08-数组和指针">Lecture08-数组和指针</a></li><li><a href="/2022/11/01/cpp/Lecture09-%E6%8C%87%E9%92%88/" rel="bookmark" title="Lecture09-指针">Lecture09-指针</a></li><li><a href="/2022/11/02/cpp/Lecture10-OOP/" rel="bookmark" title="Lecture10-OOP">Lecture10-OOP</a></li><li class="active"><a href="/2022/11/21/cpp/Homework4-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="bookmark" title="Homework4-内存管理">Homework4-内存管理</a></li><li><a href="/2023/02/08/cpp/Lecture11-%E7%BB%A7%E6%89%BF%E3%80%81%E8%99%9A%E5%87%BD%E6%95%B0/" rel="bookmark" title="Lecture11-继承、虚函数">Lecture11-继承、虚函数</a></li><li><a href="/2023/02/08/cpp/Lecture12-%E5%A4%9A%E6%80%81/" rel="bookmark" title="Lecture12-多态">Lecture12-多态</a></li><li><a href="/2023/02/08/cpp/Lecture13-newdelete/" rel="bookmark" title="Lecture13-newdelete">Lecture13-newdelete</a></li><li><a href="/2023/02/08/cpp/Lecture14-%E6%A8%A1%E6%9D%BF/" rel="bookmark" title="Lecture14-模板">Lecture14-模板</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="quas-modo" data-src="/images/avatar.jpg"><p class="name" itemprop="name">quas-modo</p><div class="description" itemprop="description">notes/thoughts/nonsense</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">67</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">18</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">12</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3F1YXMtbW9kbw==" title="https:&#x2F;&#x2F;github.com&#x2F;quas-modo"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/11/15/COA/Lecture10-%E6%A3%80%E9%94%99%E4%B8%8E%E7%BA%A0%E9%94%99/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/21/COA/Lecture11-RAID/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/" title="分类于 互联网计算">互联网计算</a></div><span><a href="/2023/02/08/internet-computer/Lecture03-%E9%93%BE%E8%B7%AF%E5%B1%82/" title="Lecture03-链路层">Lecture03-链路层</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%AF%94%E8%B5%9B/" title="分类于 比赛">比赛</a></div><span><a href="/2023/05/25/thoughts/%E6%9F%90%E5%A4%A7%E5%AD%A6-vivo%E7%BC%96%E7%A8%8B%E9%A9%AC%E6%8B%89%E6%9D%BE%E5%A4%A7%E8%B5%9B%E5%86%B3%E8%B5%9B%E8%AE%B0%E5%BD%95/" title="某大学-vivo编程马拉松大赛决赛记录">某大学-vivo编程马拉松大赛决赛记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/" title="分类于 互联网计算">互联网计算</a></div><span><a href="/2023/02/08/internet-computer/Lecture05-%E4%BC%A0%E8%BE%93%E5%B1%82/" title="Lecture05-传输层">Lecture05-传输层</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="分类于 数据结构">数据结构</a></div><span><a href="/2022/12/05/dataStructure/Lecture06-PriorityQueue/" title="Lecture06-PriorityQueue">Lecture06-PriorityQueue</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/cpp/" title="分类于 cpp">cpp</a></div><span><a href="/2022/09/15/cpp/Lecture03-%E7%BB%93%E6%9E%84%E5%8C%96%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" title="Lecture03-结构化程序设计">Lecture03-结构化程序设计</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E4%B8%8E%E7%BB%93%E6%9E%84/" title="分类于 计算机组成与结构">计算机组成与结构</a></div><span><a href="/2023/02/10/COA/Lecture17-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/" title="Lecture17-输入输出">Lecture17-输入输出</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%B8%93%E4%B8%9A%E4%B9%A6%E7%B1%8D/" title="分类于 专业书籍">专业书籍</a> <i class="ic i-angle-right"></i> <a href="/categories/%E4%B8%93%E4%B8%9A%E4%B9%A6%E7%B1%8D/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/" title="分类于 计算机网络自顶向下">计算机网络自顶向下</a></div><span><a href="/2022/09/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/Lecture04-%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2/" title="Lecture04-网络层：数据平面">Lecture04-网络层：数据平面</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E4%B8%8E%E7%BB%93%E6%9E%84/" title="分类于 计算机组成与结构">计算机组成与结构</a></div><span><a href="/2022/10/14/COA/Lecture05-%E6%B5%AE%E7%82%B9%E6%95%B0%E8%AE%A1%E7%AE%97/" title="Lecture05-浮点数计算">Lecture05-浮点数计算</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/NJUSE/" title="分类于 NJUSE">NJUSE</a> <i class="ic i-angle-right"></i> <a href="/categories/NJUSE/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E4%B8%8E%E7%BB%93%E6%9E%84/" title="分类于 计算机组成与结构">计算机组成与结构</a></div><span><a href="/2022/12/02/COA/Lecture14-%E6%8C%87%E4%BB%A4/" title="Lecture14-指令系统">Lecture14-指令系统</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%B8%93%E4%B8%9A%E4%B9%A6%E7%B1%8D/" title="分类于 专业书籍">专业书籍</a> <i class="ic i-angle-right"></i> <a href="/categories/%E4%B8%93%E4%B8%9A%E4%B9%A6%E7%B1%8D/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/" title="分类于 计算机网络自顶向下">计算机网络自顶向下</a></div><span><a href="/2022/09/13/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/Lecture03-%E4%BC%A0%E8%BE%93%E5%B1%82/" title="Lecture03-传输层">Lecture03-传输层</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-quas-modo"></i> </span><span class="author" itemprop="copyrightHolder">quas-modo @ quas-modo</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">305k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:37</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/11/21/cpp/Homework4-内存管理/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->